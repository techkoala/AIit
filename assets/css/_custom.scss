// ==============================
// Custom style - Apple Liquid Glass Design
// 自定义样式 - 苹果液态玻璃设计
// ==============================

// ==============================
// 1. Liquid Glass Core Tokens
// ==============================
:root {
  // Liquid Glass 基础效果
  --liquid-blur: 24px;
  --liquid-saturation: 180%;
  --liquid-brightness: 1.05;

  // 多层透明度
  --liquid-bg-primary: rgba(255, 255, 255, 0.72);
  --liquid-bg-secondary: rgba(255, 255, 255, 0.45);

  // 光影边框（模拟折射）
  --liquid-border-light: rgba(255, 255, 255, 0.6);
  --liquid-border-dark: rgba(0, 0, 0, 0.08);

  // 内发光效果
  --liquid-inner-glow: inset 0 1px 1px rgba(255, 255, 255, 0.8),
    inset 0 -1px 1px rgba(0, 0, 0, 0.05);

  // 外阴影（悬浮感）
  --liquid-shadow: 0 8px 32px rgba(0, 0, 0, 0.08),
    0 2px 8px rgba(0, 0, 0, 0.04);
  --liquid-shadow-hover: 0 16px 48px rgba(0, 0, 0, 0.12),
    0 4px 12px rgba(0, 0, 0, 0.06);

  // 高光渐变
  --liquid-highlight: linear-gradient(135deg,
      rgba(255, 255, 255, 0.4) 0%,
      rgba(255, 255, 255, 0.1) 50%,
      transparent 100%);

  // 强调色渐变
  --accent-primary: hsl(220, 85%, 65%);
  --accent-secondary: hsl(260, 75%, 70%);
  --accent-gradient: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));

  // 保持向后兼容
  --glass-bg: var(--liquid-bg-primary);
  --glass-border: var(--liquid-border-dark);
  --glass-blur: var(--liquid-blur);
}

html.dark {
  // 基础颜色
  --bgColor-default: #1c1c1c !important;
  --bgColor-secondary: #2d2d2d !important;
  --bgColor-accent-emphasis: #404040 !important;
  --bgColor-accent-muted: rgba(64, 64, 64, 0.1) !important;
  --borderColor-default: #404040 !important;
  --bgColor-neutral-muted: rgba(118, 118, 118, 0.4) !important;
  --selection-bgColor: rgba(64, 64, 64, 0.7) !important;

  // 按钮颜色
  --button-default-bgColor-rest: #2d2d2d !important;
  --button-default-bgColor-hover: #363636 !important;

  // 文字和链接颜色
  --fgColor-default: #e6e6e6 !important;
  --fgColor-secondary: #d4d4d4 !important;
  --fgColor-muted: #8d8d8d !important;
  --fgColor-link: #a0a0a0 !important;
  --fgColor-link-hover: #c0c0c0 !important;

  // 全局颜色
  --global-background-color: var(--bgColor-default) !important;
  --global-font-color: var(--fgColor-default) !important;
  --global-font-secondary-color: var(--fgColor-secondary) !important;
  --global-link-color: var(--fgColor-default) !important;
  --global-link-hover-color: #ffffff !important;
  --global-border-color: var(--borderColor-default) !important;

  // 头部颜色
  --header-background-color: var(--bgColor-secondary) !important;
  --header-hover-color: #ffffff !important;

  // 表格颜色
  --table-background-color: var(--bgColor-default) !important;
  --table-thead-color: var(--bgColor-secondary) !important;
  --table-border-color: var(--borderColor-default) !important;

  // 引用块颜色
  --blockquote-color: #404040 !important;
  --blockquote-bg-color: rgba(64, 64, 64, 0.2) !important;

  // 代码颜色
  --code-background-color: #2d2d2d !important;
  --code-header-color: #363636 !important;
  --code-background-color-darken-5: #363636 !important;
  --code-background-color-darken-6: #404040 !important;
  --code-background-color-code-header: var(--code-background-color-darken-6) !important;
  --code-background-color-code-hl: #4d4d4d !important;
  --code-info-color: #8d8d8d !important;

  // 其他元素颜色
  --friend-link-background-color: var(--bgColor-secondary) !important;
  --friend-link-color: var(--fgColor-link) !important;
  --friend-link-hover-color: var(--fgColor-link-hover) !important;

  --related-background-color: var(--bgColor-secondary) !important;
  --related-color: var(--fgColor-default) !important;
  --related-hover-color: #ffffff !important;

  --showcase-background-color: var(--bgColor-secondary) !important;
  --showcase-color: var(--fgColor-default) !important;
  --showcase-hover-color: #ffffff !important;

  // Liquid Glass 暗色模式覆盖
  --liquid-bg-primary: rgba(40, 40, 45, 0.78);
  --liquid-bg-secondary: rgba(50, 50, 55, 0.55);
  --liquid-border-light: rgba(255, 255, 255, 0.15);
  --liquid-border-dark: rgba(0, 0, 0, 0.3);
  --liquid-inner-glow: inset 0 1px 1px rgba(255, 255, 255, 0.1),
    inset 0 -1px 1px rgba(0, 0, 0, 0.2);
  --liquid-shadow: 0 8px 32px rgba(0, 0, 0, 0.4),
    0 2px 8px rgba(0, 0, 0, 0.2);
  --liquid-shadow-hover: 0 16px 48px rgba(0, 0, 0, 0.5),
    0 4px 12px rgba(0, 0, 0, 0.3);
  --liquid-highlight: linear-gradient(135deg,
      rgba(255, 255, 255, 0.15) 0%,
      rgba(255, 255, 255, 0.05) 50%,
      transparent 100%);

  // 向后兼容
  --glass-bg: var(--liquid-bg-primary);
  --glass-border: var(--liquid-border-dark);
  --border-gradient: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05)) !important;
}

// ==============================
// 2. Liquid Glass Core Application
// ==============================
header#header-desktop,
header#header-mobile .header-container {
  background: var(--liquid-bg-primary) !important;
  backdrop-filter: blur(var(--liquid-blur)) saturate(var(--liquid-saturation)) brightness(var(--liquid-brightness)) !important;
  -webkit-backdrop-filter: blur(var(--liquid-blur)) saturate(var(--liquid-saturation)) brightness(var(--liquid-brightness)) !important;

  // 多层边框模拟折射
  border: 1px solid var(--liquid-border-light) !important;
  border-bottom-color: var(--liquid-border-dark) !important;
  border-right-color: var(--liquid-border-dark) !important;

  // 内发光 + 外阴影
  box-shadow: var(--liquid-inner-glow), var(--liquid-shadow) !important;

  // 圆角（桌面端）
  border-radius: 0 0 20px 20px !important;

  // 过渡动画
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;

  &:hover {
    box-shadow: var(--liquid-inner-glow), var(--liquid-shadow-hover) !important;
  }
}

// 移动端 header 不需要底部圆角
header#header-mobile {
  border-radius: 0 !important;

  .header-container {
    border-radius: 0 !important;
  }
}

#toc-auto,
#toc-dialog,
.search-dropdown .dropdown-menu {
  background: var(--liquid-bg-secondary) !important;
  backdrop-filter: blur(var(--liquid-blur)) saturate(var(--liquid-saturation)) !important;
  -webkit-backdrop-filter: blur(var(--liquid-blur)) saturate(var(--liquid-saturation)) !important;
  border: 1px solid var(--liquid-border-light) !important;
  border-bottom-color: var(--liquid-border-dark) !important;
  border-right-color: var(--liquid-border-dark) !important;
  box-shadow: var(--liquid-inner-glow), var(--liquid-shadow) !important;
  border-radius: 16px !important;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
}

.fixed-button {
  background: var(--liquid-bg-secondary) !important;
  backdrop-filter: blur(var(--liquid-blur)) saturate(var(--liquid-saturation)) !important;
  -webkit-backdrop-filter: blur(var(--liquid-blur)) saturate(var(--liquid-saturation)) !important;
  border: 1px solid var(--liquid-border-light) !important;
  box-shadow: var(--liquid-inner-glow), var(--liquid-shadow) !important;
  border-radius: 50% !important;
  width: 48px !important;
  height: 48px !important;
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;

  &:hover {
    transform: scale(1.1) translateY(-4px) !important;
    box-shadow: var(--liquid-inner-glow), var(--liquid-shadow-hover) !important;
  }

  // 涟漪效果
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(circle at center,
        rgba(255, 255, 255, 0.3) 0%,
        transparent 60%);
    opacity: 0;
    transform: scale(0.5);
    transition: all 0.4s ease;
    pointer-events: none;
  }

  &:active::after {
    opacity: 1;
    transform: scale(1.5);
  }
}

// ==============================
// 3. Enhanced Micro-interactions
// ==============================
@keyframes spring-bounce {

  0%,
  100% {
    transform: scale(1);
  }

  25% {
    transform: scale(1.15);
  }

  50% {
    transform: scale(0.95);
  }

  75% {
    transform: scale(1.05);
  }
}

.search-toggle,
.theme-switch,
.menu-item i,
.menu-item svg,
.fixed-button i,
.fixed-button svg {
  transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1),
    filter 0.3s ease,
    color 0.2s ease !important;

  &:hover {
    transform: scale(1.2) translateY(-3px) !important;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
    color: var(--global-link-hover-color) !important;
  }

  &:active {
    animation: spring-bounce 0.4s ease !important;
  }
}

.search-button.search-toggle svg {
  transition: all 0.4s cubic-bezier(0.68, -0.6, 0.32, 1.6) !important;
}

.open .search-button.search-toggle svg {
  transform: rotate(90deg) scale(1.1) !important;
}

// ==============================
// 4. Simple Centered Footer
// ==============================
.footer-container {
  display: flex !important;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.25rem;
  padding: 1rem 1rem !important;
  text-align: center !important;

  .footer-line {
    margin: 0 !important;
    padding: 0;
    background: transparent;
    border: none;
    border-radius: 0;
    box-shadow: none;

    // 隐藏标题（简洁模式不需要）
    .footer-title {
      display: none;
    }

    .footer-block-content {
      font-size: 0.875rem;
      line-height: 1.8;
      color: var(--fgColor-muted, #8d8d8d);

      a {
        color: var(--global-link-color);
        transition: color 0.2s ease;

        &:hover {
          color: var(--global-link-hover-color);
          text-decoration: none;
        }
      }
    }

    .stack-links,
    .copyright-info,
    .stats-info {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      justify-content: center;
    }

    // 恢复分隔符显示
    .icp-splitter {
      display: inline !important;
    }
  }
}

// ==============================
// 5. Dynamic Light Highlight (JS 配合)
// ==============================
header#header-desktop,
#toc-auto,
#toc-dialog,
.search-dropdown .dropdown-menu,
.admonition,
.highlight {
  position: relative;
  overflow: hidden;

  // 动态光晕层
  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    background: radial-gradient(400px circle at var(--highlight-x, 50%) var(--highlight-y, 50%),
        rgba(255, 255, 255, 0.25) 0%,
        transparent 50%);
    opacity: var(--highlight-opacity, 0);
    transition: opacity 0.3s ease;
    z-index: 10;
  }
}

html.dark {

  header#header-desktop,
  #toc-auto,
  #toc-dialog,
  .search-dropdown .dropdown-menu,
  .admonition,
  .highlight {
    &::after {
      background: radial-gradient(400px circle at var(--highlight-x, 50%) var(--highlight-y, 50%),
          rgba(255, 255, 255, 0.12) 0%,
          transparent 50%);
    }
  }
}

// ==============================
// 6. 3D Depth on Code Blocks & Admonitions
// ==============================
.highlight {
  position: relative;
  background: var(--liquid-bg-secondary) !important;
  backdrop-filter: blur(12px) saturate(150%);
  -webkit-backdrop-filter: blur(12px) saturate(150%);
  border: 1px solid var(--liquid-border-light);
  border-bottom-color: var(--liquid-border-dark);
  border-right-color: var(--liquid-border-dark);
  border-radius: 12px !important;
  box-shadow: var(--liquid-inner-glow), var(--liquid-shadow);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;

  &:hover {
    transform: translateY(-2px);
    box-shadow: var(--liquid-inner-glow), var(--liquid-shadow-hover);
  }

  pre {
    background: transparent !important;
    margin: 0;
  }
}

.admonition {
  position: relative;
  backdrop-filter: blur(8px) saturate(140%);
  -webkit-backdrop-filter: blur(8px) saturate(140%);
  border: 1px solid var(--liquid-border-light) !important;
  border-left-width: 4px !important;
  border-radius: 12px !important;
  box-shadow: var(--liquid-inner-glow), 0 4px 16px rgba(0, 0, 0, 0.06);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;

  &:hover {
    transform: translateY(-2px) scale(1.005);
    box-shadow: var(--liquid-inner-glow), 0 8px 24px rgba(0, 0, 0, 0.1);
  }

  // 玻璃感背景覆盖
  &.note {
    background: rgba(68, 138, 255, 0.08) !important;
  }

  &.tip {
    background: rgba(0, 191, 165, 0.08) !important;
  }

  &.info {
    background: rgba(0, 184, 212, 0.08) !important;
  }

  &.warning {
    background: rgba(255, 145, 0, 0.08) !important;
  }

  &.danger {
    background: rgba(255, 23, 68, 0.08) !important;
  }

  &.important {
    background: rgba(137, 87, 229, 0.08) !important;
  }
}

// ==============================
// 7. Extended Glass Color System
// ==============================
// 渐变边框效果
.gradient-border {
  position: relative;
  background: var(--liquid-bg-primary);

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    padding: 1px;
    border-radius: inherit;
    background: var(--accent-gradient);
    -webkit-mask: linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    mask: linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    pointer-events: none;
  }
}

// 暗色模式专属渐变边框
html.dark {

  // Header 渐变边框
  header#header-desktop,
  header#header-mobile .header-container {
    border-image: linear-gradient(135deg,
        rgba(255, 255, 255, 0.15) 0%,
        rgba(255, 255, 255, 0.05) 50%,
        rgba(255, 255, 255, 0.1) 100%) 1;
  }

  // 代码块渐变高光
  .highlight {
    &::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.2) 50%,
          transparent 100%);
      pointer-events: none;
    }
  }

  // Admonition 增强
  .admonition {
    box-shadow: var(--liquid-inner-glow), 0 4px 16px rgba(0, 0, 0, 0.3);

    &:hover {
      box-shadow: var(--liquid-inner-glow), 0 8px 24px rgba(0, 0, 0, 0.4);
    }
  }
}

// 行内代码玻璃效果
code:not(pre code) {
  background: var(--liquid-bg-secondary) !important;
  border: 1px solid var(--liquid-border-dark);
  border-radius: 6px;
  padding: 0.15em 0.4em;
  font-size: 0.9em;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5);
}

html.dark code:not(pre code) {
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

// 表格玻璃效果
table {
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: var(--liquid-shadow);

  thead {
    background: var(--liquid-bg-secondary);
  }
}

// ==============================
// 8. Responsive & Performance
// ==============================
@media (max-width: 768px) {
  :root {
    --liquid-blur: 16px; // 降低模糊强度，提升性能
  }

  header#header-desktop,
  header#header-mobile .header-container {
    border-radius: 0 !important;
  }

  .footer-container {
    padding: 2rem 1rem !important;

    .footer-line {

      // 移动端简化
      &:hover {
        transform: none;
      }
    }
  }

  // 移动端禁用动态光影（性能考虑）
  header#header-desktop,
  #toc-auto,
  .admonition,
  .highlight {
    &::after {
      display: none !important;
    }
  }
}

// 减少动画偏好
@media (prefers-reduced-motion: reduce) {

  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}

// 性能优化：GPU 加速
.fixed-button,
header,
#toc-auto,
.highlight,
.admonition {
  will-change: transform;
  transform: translateZ(0);
  backface-visibility: hidden;
}

// 不支持 backdrop-filter 的降级方案
@supports not (backdrop-filter: blur(10px)) {

  header#header-desktop,
  header#header-mobile .header-container,
  #toc-auto,
  #toc-dialog,
  .search-dropdown .dropdown-menu,
  .fixed-button,
  .highlight,
  .admonition {
    background: rgba(255, 255, 255, 0.95) !important;
  }

  html.dark {

    header#header-desktop,
    header#header-mobile .header-container,
    #toc-auto,
    #toc-dialog,
    .search-dropdown .dropdown-menu,
    .fixed-button,
    .highlight,
    .admonition {
      background: rgba(45, 45, 45, 0.95) !important;
    }
  }
}